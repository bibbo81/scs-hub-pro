
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Shipments</title>
  <link rel="stylesheet" href="/assets/css/tracking-table.css" />
  <link rel="stylesheet" href="/assets/css/tracking-complete.css" />
  <link rel="stylesheet" href="/assets/css/shipments.css" />
  <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
  <script type="module" src="/core/header-component.js"></script>
</head>
<body>
  <div id="header-root"></div>

  <div class="table-container" style="padding: 1rem;">
    <div class="export-buttons">
      <button onclick="exportTableToXLSX('spedizioni.xlsx')">Esporta XLSX</button>
    </div>
    <table class="data-table">
      <thead>
        <tr>
          <th class="sortable">Numero Spedizione</th>
          <th class="sortable">Tracking</th>
          <th class="sortable">Stato</th>
          <th class="sortable">Origine</th>
          <th class="sortable">Destinazione</th>
          <th class="sortable">ETA</th>
          <th class="sortable">Compagnia</th>
          <th class="sortable">Container</th>
          <th class="sortable">Tipo</th>
          <th>Azioni</th>
        </tr>
      </thead>
      <tbody id="shipmentsTableBody">
        <!-- Righe dinamiche -->
      </tbody>
    </table>
  </div>

  <script type="module">
    import '/core/header-component.js';

    document.addEventListener("DOMContentLoaded", () => {
      if (!document.getElementById("app-header")) {
        const header = document.createElement("app-header");
        document.getElementById("header-root").appendChild(header);
      }
    });

    // Funzione export
    function exportTableToXLSX(filename) {
      const ws = XLSX.utils.table_to_sheet(document.querySelector(".data-table"));
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Spedizioni");
      XLSX.writeFile(wb, filename);
    }

    // Ordinamento colonne
    document.querySelectorAll(".sortable").forEach(th => {
      th.style.cursor = "pointer";
      th.addEventListener("click", () => {
        const table = th.closest("table");
        const tbody = table.querySelector("tbody");
        const index = Array.from(th.parentNode.children).indexOf(th);
        const rows = Array.from(tbody.querySelectorAll("tr"));
        const asc = !th.classList.contains("asc");

        rows.sort((a, b) => {
          const aText = a.children[index].textContent.trim();
          const bText = b.children[index].textContent.trim();
          return asc ? aText.localeCompare(bText) : bText.localeCompare(aText);
        });

        rows.forEach(row => tbody.appendChild(row));
        table.querySelectorAll("th").forEach(h => h.classList.remove("asc", "desc"));
        th.classList.add(asc ? "asc" : "desc");
      });
    });

    // Simulazione fetch e rendering
    document.addEventListener("DOMContentLoaded", async () => {
      const shipments = [
        {
          id: 1,
          shipment_number: "SHP001",
          tracking_number: "TRK123",
          status: "In transito",
          origin: "Milano",
          destination: "Madrid",
          eta: "2025-07-25",
          carrier_name: "DHL",
          container_size: "20FT",
          container_type: "Dry"
        }
      ];
      const tbody = document.getElementById("shipmentsTableBody");
      shipments.forEach(s => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${s.shipment_number}</td>
          <td>${s.tracking_number}</td>
          <td><span class="sol-badge sol-badge-primary">${s.status}</span></td>
          <td>${s.origin}</td>
          <td>${s.destination}</td>
          <td>${new Date(s.eta).toLocaleDateString('it-IT')}</td>
          <td>${s.carrier_name}</td>
          <td>${s.container_size}</td>
          <td>${s.container_type}</td>
          <td><button class="sol-btn sol-btn-sm details-btn" data-id="${s.id}">Dettagli</button></td>
        `;
        tbody.appendChild(tr);
      });

      // Bind modale dettagli
      document.querySelectorAll(".details-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-id");
          alert(`Mostra dettagli per ID: ${id}`);
        });
      });
    });
  </script>
</body>
</html>